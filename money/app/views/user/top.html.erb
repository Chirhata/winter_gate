<% require "active_support/time" %>
<div class="top top-main">
  <div class="top message">
    <% @user_name = User.find_by(id: session[:user_id])%>
    <% user_tomonth_target = User.find_by(id: session[:user_id]) %>
    <% date = Date.today %>
    <% if user_tomonth_target.money_limit && user_tomonth_target.money_limit_day && date < user_tomonth_target.money_limit_day%>
      <h1>今使える金額は<%=@user_name.money_limit%>円</h1>
      <% if @warning %>
      <div class="warning">
        <%= @warning %>
      </div> 
      <% end %>
      <script>
      window.onload = function(){
        var canvas = document.getElementById('canvas');
        var context = canvas.getContext('2d');
        if (gon.percentage >= 51){
          context.fillStyle = "green";
        }
        else if(gon.percentage < 51 && gon.percentage　>= 26){
          context.fillStyle = "yellow";
        }
        else{
          context.fillStyle = "red";
        }
        context.fillRect(0, 0, 5 * gon.percentage, 50);
      }
      </script>
      <canvas id = "canvas" width = "500" height = "35" style = "border:2px solid #000;background-color: blue;"></canvas>
      <% if @over > 0%>
        <h3>+<%=@over%>円</h3>
      <%end%>
      <p></p>
      <%=date%>
      <%=user_tomonth_target.money_limit_day%>
      <%=date < user_tomonth_target.money_limit_day%>
    <%else%>
      <h1>今月分の目標額を設定しましょう。</h1>
      <%=date%>
      <%=user_tomonth_target.money_limit_day%>
      <%=date < user_tomonth_target.money_limit_day%>
      <%= link_to("設定する", "/money/#{@user_name.id}/form_tomonth") %>
    <%end%>
  </div>
</div>
